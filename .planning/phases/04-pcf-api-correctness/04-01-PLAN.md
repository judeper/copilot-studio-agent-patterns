---
phase: 04-pcf-api-correctness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - enterprise-work-assistant/src/AssistantDashboard/components/types.ts
  - enterprise-work-assistant/src/AssistantDashboard/components/constants.ts
  - enterprise-work-assistant/src/AssistantDashboard/hooks/useCardData.ts
  - enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
autonomous: true
requirements:
  - PCF-02
  - PCF-03

must_haves:
  truths:
    - "No 'N/A' string values appear in Priority or TemporalHorizon type unions in types.ts"
    - "Priority badge is hidden entirely when card.priority is null -- no empty badge rendered"
    - "Temporal horizon badge is hidden entirely when card.temporal_horizon is null -- no empty badge rendered"
    - "Draft payload guards use truthiness checks only -- no '!== N/A' string comparisons anywhere"
    - "item_summary renders directly without ?? 'No summary available' fallback or String() coercion"
    - "Priority color map exists only in constants.ts -- no duplicate map in CardItem.tsx or CardDetail.tsx"
    - "bun run build and bun run lint both pass with zero errors and zero warnings"
  artifacts:
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/types.ts"
      provides: "Priority and TemporalHorizon types without N/A, nullable fields in AssistantCard"
      contains: "priority: Priority | null"
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/constants.ts"
      provides: "Shared PRIORITY_COLORS map with High/Medium/Low entries only"
      exports: ["PRIORITY_COLORS"]
    - path: "enterprise-work-assistant/src/AssistantDashboard/hooks/useCardData.ts"
      provides: "Null fallbacks for priority/temporal_horizon, simplified item_summary"
      contains: "?? null"
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx"
      provides: "Truthiness guards for temporal_horizon, imports PRIORITY_COLORS from constants"
      contains: "PRIORITY_COLORS"
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx"
      provides: "Conditional priority badge, truthiness guards for temporal_horizon and draft_payload"
      contains: "card.priority &&"
  key_links:
    - from: "components/types.ts"
      to: "hooks/useCardData.ts"
      via: "Priority | null and TemporalHorizon | null types used in AssistantCard construction"
      pattern: "priority.*Priority.*null"
    - from: "components/constants.ts"
      to: "components/CardItem.tsx"
      via: "PRIORITY_COLORS import replaces local priorityColors map"
      pattern: "import.*PRIORITY_COLORS.*constants"
    - from: "components/constants.ts"
      to: "components/CardDetail.tsx"
      via: "PRIORITY_COLORS import replaces local priorityColors map"
      pattern: "import.*PRIORITY_COLORS.*constants"
    - from: "hooks/useCardData.ts"
      to: "components/CardItem.tsx"
      via: "Null priority/temporal_horizon values flow to truthiness guards"
      pattern: "card\\.priority &&|card\\.temporal_horizon &&"
---

<objective>
Fix Fluent UI v9 API correctness (verify Badge sizes and color tokens) and clean up contract drift from Phase 1's null convention: remove "N/A" from type unions, consolidate the duplicated priority color map, replace all "N/A" string guards with truthiness checks, and simplify defensive item_summary patterns.

Purpose: Align the PCF component code with the Phase 1 null convention (SCHM-06) and confirm all Fluent UI v9 component props and tokens are valid. After this phase, the display layer trusts the type contract and no vestigial "N/A" string references remain.

Output: Five files (4 modified + 1 new) with clean types, shared constants, and consistent null-aware display logic. Build and lint pass clean.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pcf-api-correctness/04-RESEARCH.md
@.planning/phases/04-pcf-api-correctness/04-CONTEXT.md
@.planning/phases/03-pcf-build-configuration/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update types, create shared constants, and fix useCardData hook</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/components/types.ts
    enterprise-work-assistant/src/AssistantDashboard/components/constants.ts
    enterprise-work-assistant/src/AssistantDashboard/hooks/useCardData.ts
  </files>
  <action>
**types.ts** -- Remove "N/A" from type unions and make fields nullable:
1. Change `export type Priority = "High" | "Medium" | "Low" | "N/A";` to `export type Priority = "High" | "Medium" | "Low";`
2. Change `export type TemporalHorizon = "TODAY" | "THIS_WEEK" | "NEXT_WEEK" | "BEYOND" | "N/A";` to `export type TemporalHorizon = "TODAY" | "THIS_WEEK" | "NEXT_WEEK" | "BEYOND";`
3. In AssistantCard interface, change `priority: Priority;` to `priority: Priority | null;`
4. In AssistantCard interface, change `temporal_horizon: TemporalHorizon;` to `temporal_horizon: TemporalHorizon | null;`

**constants.ts** -- Create NEW shared constants file at `components/constants.ts`:
```typescript
import { tokens } from "@fluentui/react-components";

/**
 * Priority-to-color mapping for badge border/background styling.
 * Only valid priority values have entries -- null priority hides the badge entirely.
 */
export const PRIORITY_COLORS: Record<string, string> = {
    High: tokens.colorPaletteRedBorder2,
    Medium: tokens.colorPaletteMarigoldBorder2,
    Low: tokens.colorPaletteGreenBorder2,
};
```
No "N/A" entry, no fallback/default color. Strict entries for High/Medium/Low only per user decision.

**useCardData.ts** -- Fix fallbacks for priority, temporal_horizon, and item_summary:
1. Change line 47 priority fallback from `(parsed.priority as Priority) ?? "N/A"` to:
   ```typescript
   priority: parsed.priority && parsed.priority !== "N/A"
       ? (parsed.priority as Priority)
       : null,
   ```
   This maps the agent's "N/A" string output to null for the UI type contract. The `?? null` alone would not catch an actual "N/A" string from the JSON (since "N/A" is truthy).

2. Change line 48 temporal_horizon fallback from `(parsed.temporal_horizon as TemporalHorizon) ?? "N/A"` to:
   ```typescript
   temporal_horizon: parsed.temporal_horizon && parsed.temporal_horizon !== "N/A"
       ? (parsed.temporal_horizon as TemporalHorizon)
       : null,
   ```
   Same pattern -- maps "N/A" from agent JSON to null for the UI.

3. Change line 46 item_summary from `String(parsed.item_summary ?? record.getValue("cr_itemsummary") ?? "")` to:
   ```typescript
   item_summary: parsed.item_summary ?? "",
   ```
   Per user decision: remove `String()` wrapper and cascading fallback chain. Trust the parsed data. item_summary is non-nullable string per Phase 1 contract. The `?? ""` is a minimal safety net for truly missing data, not a defensive pattern.
  </action>
  <verify>
Run `cd enterprise-work-assistant/src && npx tsc --noEmit` to verify type consistency. types.ts should compile without errors. useCardData.ts should compile without errors (the null assignments match the new `Priority | null` and `TemporalHorizon | null` types). constants.ts should export PRIORITY_COLORS without errors.
  </verify>
  <done>
types.ts has Priority without "N/A" and TemporalHorizon without "N/A". AssistantCard.priority is `Priority | null` and AssistantCard.temporal_horizon is `TemporalHorizon | null`. constants.ts exports PRIORITY_COLORS with exactly three entries (High, Medium, Low). useCardData.ts maps "N/A" from parsed JSON to null for both priority and temporal_horizon. useCardData.ts item_summary uses `parsed.item_summary ?? ""` with no String() wrapper or cascading fallback.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix CardItem.tsx and CardDetail.tsx display guards and verify build</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
  </files>
  <action>
**CardItem.tsx** -- Replace local priority map with shared constants and fix guards:
1. Add import: `import { PRIORITY_COLORS } from "./constants";`
2. Remove the entire local `priorityColors` map (lines 20-25):
   ```typescript
   // DELETE:
   const priorityColors: Record<string, string> = {
       High: tokens.colorPaletteRedBorder2,
       Medium: tokens.colorPaletteMarigoldBorder2,
       Low: tokens.colorPaletteGreenBorder2,
       "N/A": tokens.colorNeutralStroke1,
   };
   ```
3. Remove `tokens` from the `@fluentui/react-components` import (line 6) since it is no longer used directly in this file. Keep Card, Badge, Text. Verify `tokens` is not used elsewhere in the file before removing.
4. Change line 48 border color logic from `const borderColor = priorityColors[card.priority] || tokens.colorNeutralStroke1;` to:
   ```typescript
   const borderColor = card.priority ? PRIORITY_COLORS[card.priority] : undefined;
   ```
   And update the style to conditionally apply the border:
   ```typescript
   style={borderColor ? { borderLeft: `4px solid ${borderColor}` } : undefined}
   ```
   This hides the priority border entirely when priority is null, consistent with the "hide on null" decision.

5. Change line 68 temporal_horizon guard from `{card.temporal_horizon !== "N/A" && (` to `{card.temporal_horizon && (`

6. Change line 76 item_summary from `{card.item_summary ?? "No summary available"}` to `{card.item_summary}`

**CardDetail.tsx** -- Replace local priority map, add null guard for priority badge, fix all N/A guards:
1. Add import: `import { PRIORITY_COLORS } from "./constants";`
2. Remove the entire local `priorityColors` map (lines 23-28):
   ```typescript
   // DELETE:
   const priorityColors: Record<string, string> = {
       High: tokens.colorPaletteRedBorder2,
       Medium: tokens.colorPaletteMarigoldBorder2,
       Low: tokens.colorPaletteGreenBorder2,
       "N/A": tokens.colorNeutralStroke1,
   };
   ```
3. Remove `tokens` from the `@fluentui/react-components` import (line 11) since it is no longer used directly in this file. Keep Button, Badge, Text, Link, Textarea, Spinner, MessageBar, MessageBarBody. Verify `tokens` is not used elsewhere before removing.
4. Wrap the priority Badge (lines 70-76) in a null guard:
   ```typescript
   {card.priority && (
       <Badge
           appearance="filled"
           style={{ backgroundColor: PRIORITY_COLORS[card.priority] }}
           size="medium"
       >
           {card.priority}
       </Badge>
   )}
   ```
5. Change line 85 temporal_horizon guard from `{card.temporal_horizon !== "N/A" && (` to `{card.temporal_horizon && (`
6. Change line 150 draft_payload guard from `{card.draft_payload && card.draft_payload !== "N/A" && (` to `{card.draft_payload && (`
7. Change line 182 draft_payload guard from `{card.draft_payload && card.draft_payload !== "N/A" && (` to `{card.draft_payload && (`

**Build verification:**
After all changes, run:
```bash
cd enterprise-work-assistant/src && bun run build && bun run lint
```
Both must pass with zero errors and zero warnings.

**Fluent UI v9 audit confirmation:**
Per 04-RESEARCH.md, all Badge size values (small, medium), all Badge appearance values (filled, outline, tint), all Badge color values (success, warning, informative, subtle), and all token references are already valid against the Fluent UI v9 API surface. No further prop changes needed. This task confirms the audit finding by achieving a clean build.
  </action>
  <verify>
1. `cd enterprise-work-assistant/src && bun run build` exits with code 0 and zero errors
2. `cd enterprise-work-assistant/src && bun run lint` exits with code 0 and zero warnings
3. `grep -r '"N/A"' enterprise-work-assistant/src/AssistantDashboard/` returns no matches (no residual N/A string references in any component or hook)
4. `grep -r 'priorityColors' enterprise-work-assistant/src/AssistantDashboard/` returns no matches (local maps fully removed)
5. `grep -r 'PRIORITY_COLORS' enterprise-work-assistant/src/AssistantDashboard/` returns matches only in constants.ts, CardItem.tsx, and CardDetail.tsx
6. `grep -r 'No summary available' enterprise-work-assistant/src/AssistantDashboard/` returns no matches
  </verify>
  <done>
CardItem.tsx imports PRIORITY_COLORS from constants.ts, has no local priorityColors map, uses truthiness guard for temporal_horizon, renders item_summary directly without fallback, and conditionally applies priority border color only when priority is non-null. CardDetail.tsx imports PRIORITY_COLORS from constants.ts, has no local priorityColors map, wraps priority Badge in `{card.priority && (...)}` guard, uses truthiness guards for temporal_horizon and draft_payload (no "N/A" comparisons). `bun run build` and `bun run lint` both pass with zero errors and zero warnings. Zero "N/A" string references remain in any AssistantDashboard source file.
  </done>
</task>

</tasks>

<verification>
1. **Type safety:** `npx tsc --noEmit` passes -- all type references consistent across types.ts, useCardData.ts, CardItem.tsx, CardDetail.tsx
2. **Build:** `bun run build` exits 0 with zero errors
3. **Lint:** `bun run lint` exits 0 with zero warnings
4. **No N/A residue:** `grep -rn '"N/A"' enterprise-work-assistant/src/AssistantDashboard/` returns zero matches
5. **No duplicate maps:** `grep -rn 'priorityColors' enterprise-work-assistant/src/AssistantDashboard/` returns zero matches
6. **Shared constants used:** `grep -rn 'PRIORITY_COLORS' enterprise-work-assistant/src/AssistantDashboard/` shows imports in CardItem.tsx and CardDetail.tsx, definition in constants.ts
7. **PCF-02 confirmed:** All Badge size prop values are valid Fluent UI v9 values (small, medium) -- verified by clean build
8. **PCF-03 confirmed:** All color tokens are valid Fluent UI v9 names (colorPaletteRedBorder2, colorPaletteMarigoldBorder2, colorPaletteGreenBorder2) -- verified by clean build
</verification>

<success_criteria>
- Priority and TemporalHorizon types contain only valid domain values (no "N/A" sentinel)
- PRIORITY_COLORS map is defined once in constants.ts and imported by both card components
- All display guards use truthiness checks -- zero "!== 'N/A'" comparisons in the codebase
- item_summary renders directly without defensive fallbacks
- Build and lint pass clean with zero errors and zero warnings
- All Fluent UI v9 Badge sizes, appearances, colors, and token references confirmed valid
</success_criteria>

<output>
After completion, create `.planning/phases/04-pcf-api-correctness/04-01-SUMMARY.md`
</output>
