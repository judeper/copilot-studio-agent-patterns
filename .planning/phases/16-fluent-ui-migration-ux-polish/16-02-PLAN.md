---
phase: 16-fluent-ui-migration-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/App.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/__tests__/CommandBar.test.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/__tests__/App.test.tsx
autonomous: true
requirements:
  - UIUX-01
  - UIUX-04
  - UIUX-05

must_haves:
  truths:
    - "CommandBar renders using Fluent UI Input, Button, Spinner, and Card components with zero plain HTML interactive elements"
    - "App displays a Fluent UI Spinner while data is initially loading (empty cards array with no filters active)"
    - "App uses a Fluent UI Button for the Agent Performance link instead of a plain HTML button"
    - "App passes onBack to BriefingCard when in detail view mode so the Back button is visible (UIUX-05 wiring)"
    - "All existing CommandBar and App tests pass after migration"
  artifacts:
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx"
      provides: "Fluent UI CommandBar with Input, Button, Spinner"
      contains: "from \"@fluentui/react-components\""
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/App.tsx"
      provides: "App with loading state Spinner and Fluent UI Agent Performance button"
      contains: "Spinner"
  key_links:
    - from: "CommandBar.tsx"
      to: "@fluentui/react-components"
      via: "import Input, Button, Spinner, Badge"
      pattern: "import.*Input.*from.*@fluentui/react-components"
    - from: "App.tsx"
      to: "BriefingCard"
      via: "onBack prop passed in detail mode"
      pattern: "onBack.*handleBack"
---

<objective>
Migrate CommandBar from plain HTML to Fluent UI v9, add loading state Spinner to App, replace App's plain HTML button with Fluent UI Button, and wire onBack to BriefingCard in detail view.

Purpose: CommandBar is the last major plain-HTML component. Adding a loading Spinner addresses the data loading UX gap, and wiring onBack to BriefingCard connects the Back button created in Plan 16-01 to the App's navigation. The Agent Performance link also needs to be a proper Fluent UI Button.

Output: Two updated components with Fluent UI throughout, plus loading state UX improvement.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

@enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx
@enterprise-work-assistant/src/AssistantDashboard/components/App.tsx
@enterprise-work-assistant/src/AssistantDashboard/components/__tests__/CommandBar.test.tsx
@enterprise-work-assistant/src/AssistantDashboard/components/__tests__/App.test.tsx

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From components/types.ts:
```typescript
export interface CommandCardLink { card_id: string; label: string; }
export interface OrchestratorResponse { response_text: string; card_links: CommandCardLink[]; side_effects: CommandSideEffect[]; }
export interface AppProps {
    cards: AssistantCard[];
    filterTriggerType: string; filterPriority: string; filterCardStatus: string; filterTemporalHorizon: string;
    orchestratorResponse: string | null;
    isProcessing: boolean;
    width: number; height: number;
    onSelectCard: (cardId: string) => void;
    onSendDraft: (cardId: string, finalText: string, editDistanceRatio: number) => void;
    onCopyDraft: (cardId: string) => void;
    onDismissCard: (cardId: string) => void;
    onJumpToCard: (cardId: string) => void;
    onExecuteCommand: (command: string, currentCardId: string | null) => void;
}
```

Established Fluent UI patterns from CardDetail.tsx:
```typescript
import { Button, Badge, Text, Textarea, Spinner } from "@fluentui/react-components";
import { ArrowLeftRegular, SendRegular, DismissRegular } from "@fluentui/react-icons";
```

BriefingCard props (after Plan 16-01 adds onBack):
```typescript
interface BriefingCardProps {
    card: AssistantCard;
    onJumpToCard: (cardId: string) => void;
    onDismissCard: (cardId: string) => void;
    onBack?: () => void;  // Added by Plan 16-01
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate CommandBar to Fluent UI</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/__tests__/CommandBar.test.tsx
  </files>
  <action>
Replace all plain HTML elements in CommandBar.tsx with Fluent UI v9 equivalents. Follow the same patterns as CardDetail.tsx.

**Imports to add:**
```typescript
import { Button, Input, Spinner, Badge, Card, Text, tokens } from "@fluentui/react-components";
import { SendRegular, DismissCircleRegular } from "@fluentui/react-icons";
```

**Element replacements:**

1. **Text input** — Replace `<input type="text" className="command-input" ...>` with `<Input>`:
   ```typescript
   <Input
       ref={inputRef}
       className="command-input"
       placeholder={currentCardId ? "Ask about this card or type a command..." : "Type a command..."}
       value={inputText}
       onChange={(_e, data) => setInputText(data.value)}
       onKeyDown={handleKeyDown}
       disabled={isProcessing}
   />
   ```
   Note: Fluent UI Input uses `onChange={(_e, data) => setInputText(data.value)}` pattern (data.value, not e.target.value). Update the onChange handler. Also update the ref type from `HTMLInputElement` to handle Fluent Input's ref if needed (use `HTMLInputElement` as Input forwards ref).

2. **Send button** — Replace `<button className="command-send-button" ...>` with:
   ```typescript
   <Button
       appearance="primary"
       icon={<SendRegular />}
       onClick={handleSubmit}
       disabled={!inputText.trim() || isProcessing}
       size="small"
   >
       {isProcessing ? "..." : "Send"}
   </Button>
   ```

3. **Clear button** — Replace `<button className="command-clear-button" ...>` with:
   ```typescript
   <Button
       appearance="subtle"
       icon={<DismissCircleRegular />}
       onClick={handleClear}
       title="Clear conversation"
       size="small"
   />
   ```
   (Icon-only button, no text child — the "✕" character is replaced by the icon)

4. **Quick action chips** — Replace `<button className="command-quick-chip" ...>` with:
   ```typescript
   <Button appearance="outline" size="small" onClick={() => handleQuickAction(qa.command)}>
       {qa.label}
   </Button>
   ```

5. **Card link buttons** — Replace `<button className="command-card-link" ...>` with:
   ```typescript
   <Button appearance="transparent" size="small" onClick={() => onJumpToCard(link.card_id)}>
       {link.label}
   </Button>
   ```

6. **"Thinking..." indicator** — Replace `<div className="command-entry command-entry-assistant command-thinking">Thinking...</div>` with:
   ```typescript
   <div className="command-entry command-entry-assistant command-thinking">
       <Spinner size="tiny" label="Thinking..." labelPosition="after" />
   </div>
   ```

7. **Conversation entry text** — Replace `<div className="command-entry-text">` contents with `<Text block>{entry.text}</Text>`.

8. **Outer container** — Keep the `<div className="command-bar ...">` wrapper, but wrap the response panel area in appropriate Card or keep as div (response panel is a scrollable conversation log, Card is not the right semantic here — keep as div).

**Update CommandBar.test.tsx:**
- Fluent UI Input has different DOM rendering. The `screen.getByPlaceholderText(...)` should still work because Fluent Input renders an underlying `<input>` element.
- The `fireEvent.change(input, { target: { value: '...' } })` pattern may need adjustment. Fluent UI Input wraps the native input, but testing-library should still fire change events on the underlying input element. If tests fail, use `userEvent.type()` instead.
- The "✕" clear button text is now an icon — update the assertion from looking for "✕" text to looking for the button by `title="Clear conversation"` (already tested via `screen.getByTitle('Clear conversation')`).
- The `screen.getByText('...')` for the processing state button should still match since the Button text content is "...".
- Verify all 13+ existing tests pass. Adjust selectors if Fluent UI wrapper elements change the DOM structure.
  </action>
  <verify>
    <automated>cd enterprise-work-assistant/src && npx jest --config test/jest.config.ts --testPathPattern="CommandBar" --no-coverage 2>&1 | tail -20</automated>
  </verify>
  <done>CommandBar.tsx imports from @fluentui/react-components, contains zero plain HTML input/button elements, uses Fluent Input/Button/Spinner, and all 13+ CommandBar tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Add loading Spinner to App, fix Agent Performance button, wire BriefingCard onBack</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/components/App.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/__tests__/App.test.tsx
  </files>
  <action>
Three targeted changes to App.tsx:

**1. UIUX-04 — Loading state Spinner:**
Add a `Spinner` import from `@fluentui/react-components` (already imported for FluentProvider). Display a loading state when the cards array is empty AND no filters are active. This distinguishes "no data yet" from "no cards match filters":

At the top of the gallery branch (where `viewState.mode === "gallery"`), BEFORE the FilterBar, add:
```typescript
{cards.length === 0 && !filterTriggerType && !filterPriority && !filterCardStatus && !filterTemporalHorizon && (
    <div className="dashboard-loading" style={{ display: "flex", justifyContent: "center", padding: "48px 0" }}>
        <Spinner size="large" label="Loading cards..." />
    </div>
)}
```

This renders when the dataset is truly empty (initial load) but NOT when filters produce zero results (that's handled by CardGallery's existing "No cards match" empty state). The gallery/FilterBar/CardGallery content should be conditionally hidden during this loading state:
```typescript
{(cards.length > 0 || filterTriggerType || filterPriority || filterCardStatus || filterTemporalHorizon) && (
    <>
        <FilterBar ... />
        {/* Agent Performance link */}
        ...
        {/* Briefing cards */}
        ...
        <CardGallery ... />
    </>
)}
```

**2. UIUX-01 — Replace plain HTML button for Agent Performance:**
Replace:
```typescript
<button className="calibration-link" onClick={handleShowCalibration}>
    ⚙ Agent Performance
</button>
```
With:
```typescript
<Button
    appearance="transparent"
    icon={<SettingsRegular />}
    onClick={handleShowCalibration}
    size="small"
>
    Agent Performance
</Button>
```
Import `{ SettingsRegular }` from `@fluentui/react-icons` and add `Button` to the Fluent imports (or use the existing import if already there — check if Button is already imported; currently App.tsx does NOT import Button so add it). Also add `Spinner` to imports.

**3. UIUX-05 — Wire onBack to BriefingCard in detail mode:**
In the detail view branch where BriefingCard is rendered for a selected briefing card:
```typescript
) : selectedCard.trigger_type === "DAILY_BRIEFING" ? (
    <BriefingCard
        card={selectedCard}
        onJumpToCard={handleJumpToCard}
        onDismissCard={onDismissCard}
        onBack={handleBack}   // <-- ADD THIS
    />
```
This connects the Back button (added by Plan 16-01) to App's navigation. The gallery-level BriefingCard instances do NOT get onBack (they are inline summaries, not detail views).

**Update App.test.tsx:**
- Add a test: "shows loading spinner when cards are empty with no filters" — render App with `cards: []` and all filters empty, verify `screen.getByText('Loading cards...')` is present.
- Add a test: "shows filter empty state (not spinner) when cards are empty due to filter" — render App with `cards: []` and `filterTriggerType: 'CALENDAR_SCAN'`, verify "No cards match" text appears (not the spinner).
- The existing "shows empty state when no cards match filters" test should still pass because it uses a non-empty filter that triggers the CardGallery empty state.
- Verify the Agent Performance button still navigates to calibration view.
  </action>
  <verify>
    <automated>cd enterprise-work-assistant/src && npx jest --config test/jest.config.ts --testPathPattern="App\\.test" --no-coverage 2>&1 | tail -20</automated>
  </verify>
  <done>App.tsx shows Spinner for initial loading (empty cards + no filters), uses Fluent Button for Agent Performance, wires onBack to BriefingCard in detail mode, has zero remaining plain HTML button elements, and all App tests pass.</done>
</task>

</tasks>

<verification>
1. Run all tests: `cd enterprise-work-assistant/src && npx jest --config test/jest.config.ts --no-coverage`
2. Verify zero plain HTML `<button>` elements in CommandBar.tsx: `grep -c '<button' enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx` returns 0
3. Verify zero plain HTML `<input` elements in CommandBar.tsx: `grep -c '<input' enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx` returns 0
4. Verify zero plain HTML `<button>` elements in App.tsx: `grep -c '<button' enterprise-work-assistant/src/AssistantDashboard/components/App.tsx` returns 0
5. Verify Spinner import in App.tsx: `grep 'Spinner' enterprise-work-assistant/src/AssistantDashboard/components/App.tsx` finds import
6. Verify onBack wiring in App.tsx: `grep 'onBack.*handleBack' enterprise-work-assistant/src/AssistantDashboard/components/App.tsx` finds the prop
7. TypeScript compiles: `cd enterprise-work-assistant/src && npx tsc --noEmit` passes
</verification>

<success_criteria>
- CommandBar.tsx has zero plain HTML interactive elements — all replaced with Fluent UI Input/Button/Spinner
- App.tsx has zero plain HTML button elements — Agent Performance uses Fluent Button
- App.tsx shows Fluent Spinner with "Loading cards..." for initial empty state (UIUX-04)
- App.tsx passes onBack={handleBack} to BriefingCard in detail view mode (UIUX-05 wiring)
- All 13+ existing CommandBar tests pass
- All 9+ existing App tests pass, plus new loading state tests
</success_criteria>

<output>
After completion, create `.planning/phases/16-fluent-ui-migration-ux-polish/16-02-SUMMARY.md`
</output>
