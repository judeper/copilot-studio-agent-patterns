---
phase: 14-sender-intelligence-completion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - enterprise-work-assistant/src/.eslintrc.json
  - enterprise-work-assistant/src/package.json
  - enterprise-work-assistant/src/AssistantDashboard/utils/levenshtein.ts
  - enterprise-work-assistant/src/AssistantDashboard/utils/__tests__/levenshtein.test.ts
  - enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
  - enterprise-work-assistant/src/AssistantDashboard/index.ts
  - enterprise-work-assistant/src/AssistantDashboard/hooks/useCardData.ts
  - enterprise-work-assistant/src/AssistantDashboard/components/App.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/BriefingCard.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/ConfidenceCalibration.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/FilterBar.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CardGallery.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx
autonomous: true
requirements:
  - QUAL-01
  - SNDR-03

must_haves:
  truths:
    - "ESLint react-hooks plugin is installed and both rules (rules-of-hooks, exhaustive-deps) are set to error"
    - "npm run lint passes with zero hook-related errors across the entire codebase"
    - "A Levenshtein edit distance utility exists that computes normalized ratio 0-100"
    - "When user clicks Send on an edited draft, the PCF output includes editDistanceRatio in the JSON payload"
    - "Sending an unedited draft produces editDistanceRatio of 0"
  artifacts:
    - path: "enterprise-work-assistant/src/.eslintrc.json"
      provides: "ESLint config with react-hooks plugin"
      contains: "react-hooks/rules-of-hooks"
    - path: "enterprise-work-assistant/src/AssistantDashboard/utils/levenshtein.ts"
      provides: "Levenshtein edit distance computation"
      exports: ["levenshteinRatio"]
    - path: "enterprise-work-assistant/src/AssistantDashboard/utils/__tests__/levenshtein.test.ts"
      provides: "Unit tests for Levenshtein utility"
      min_lines: 20
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx"
      provides: "Edit distance computation on send"
      contains: "levenshteinRatio"
    - path: "enterprise-work-assistant/src/AssistantDashboard/index.ts"
      provides: "PCF output with editDistanceRatio in sendDraftAction JSON"
      contains: "editDistanceRatio"
  key_links:
    - from: "enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx"
      to: "enterprise-work-assistant/src/AssistantDashboard/utils/levenshtein.ts"
      via: "import levenshteinRatio"
      pattern: "import.*levenshteinRatio.*from.*levenshtein"
    - from: "enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx"
      to: "enterprise-work-assistant/src/AssistantDashboard/index.ts"
      via: "onSendDraft callback receives editDistanceRatio"
      pattern: "onSendDraft.*editDistanceRatio"
---

<objective>
Install ESLint react-hooks plugin, fix all hook dependency violations, implement Levenshtein edit distance utility, and wire edit distance into the PCF send draft flow.

Purpose: Establish code quality guardrails that catch hook dependency errors during development, and compute actual edit distance ratios (0-100) in the PCF so the downstream Power Automate flow receives a pre-computed value instead of using the simplified 0/1 boolean.

Output: Clean ESLint config with react-hooks rules enforced at error level, a tested Levenshtein utility, and CardDetail + index.ts wired to pass editDistanceRatio through the send draft output channel.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-sender-intelligence-completion/14-CONTEXT.md

@enterprise-work-assistant/src/.eslintrc.json
@enterprise-work-assistant/src/package.json
@enterprise-work-assistant/src/AssistantDashboard/index.ts
@enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
@enterprise-work-assistant/src/AssistantDashboard/components/types.ts
@enterprise-work-assistant/src/AssistantDashboard/hooks/useCardData.ts

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From enterprise-work-assistant/src/AssistantDashboard/components/types.ts:
```typescript
export type CardOutcome = "PENDING" | "SENT_AS_IS" | "SENT_EDITED" | "DISMISSED" | "EXPIRED";

export interface AssistantCard {
    id: string;
    humanized_draft: string | null;
    card_outcome: CardOutcome;
    // ... other fields
}

export interface AppProps {
    onSendDraft: (cardId: string, finalText: string) => void;
    // ... other fields
}
```

From enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx:
```typescript
interface CardDetailProps {
    card: AssistantCard;
    onBack: () => void;
    onSendDraft: (cardId: string, finalText: string) => void;
    onCopyDraft: (cardId: string) => void;
    onDismissCard: (cardId: string) => void;
}
```

From enterprise-work-assistant/src/AssistantDashboard/index.ts:
```typescript
// Line 83 — current handler:
this.handleSendDraft = (cardId: string, finalText: string) => {
    // JSON-encode for Canvas app parsing via ParseJSON()
    // Canvas app uses isEdited to set SENT_AS_IS vs SENT_EDITED outcome
    this.sendDraftAction = JSON.stringify({ cardId, finalText });
    this.notifyOutputChanged();
};
```

Current ESLint config (enterprise-work-assistant/src/.eslintrc.json):
```json
{
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended"
  ],
  "rules": {
    "@typescript-eslint/no-explicit-any": "warn",
    "no-console": ["warn", { "allow": ["warn"] }]
  },
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module",
    "ecmaFeatures": { "jsx": true }
  },
  "env": { "browser": true, "es2020": true }
}
```
</interfaces>
</context>

<tasks>

<task type="auto" tdd="true">
  <name>Task 1: Implement Levenshtein edit distance utility with tests</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/utils/levenshtein.ts
    enterprise-work-assistant/src/AssistantDashboard/utils/__tests__/levenshtein.test.ts
  </files>
  <behavior>
    - levenshteinRatio("hello", "hello") === 0 (identical strings)
    - levenshteinRatio("abc", "xyz") === 100 (complete rewrite, edit distance 3 / max length 3)
    - levenshteinRatio("kitten", "sitting") === 43 (edit distance 3 / max length 7 * 100, rounded)
    - levenshteinRatio("", "") === 0 (two empty strings)
    - levenshteinRatio("abc", "") === 100 (one empty string)
    - levenshteinRatio("", "abc") === 100 (one empty string, reversed)
    - levenshteinRatio("Hello World", "hello world") === ratio for case difference (case-sensitive)
  </behavior>
  <action>
    Create `enterprise-work-assistant/src/AssistantDashboard/utils/levenshtein.ts` with:

    1. An inline Levenshtein implementation using the two-row optimization (space O(min(m,n))):
       - Function signature: `export function levenshteinRatio(a: string, b: string): number`
       - If both empty, return 0
       - If one empty, return 100
       - Compute standard Levenshtein distance using two-row iterative approach (~15 lines)
       - Return `Math.round((distance / Math.max(a.length, b.length)) * 100)`

    2. Do NOT add `fast-levenshtein` or any external dependency — use inline implementation per user decision.

    Create the test file at `enterprise-work-assistant/src/AssistantDashboard/utils/__tests__/levenshtein.test.ts` with the behaviors above.

    Follow TDD: write tests first, run to confirm failure, then implement, run to confirm passing.
  </action>
  <verify>
    <automated>cd enterprise-work-assistant/src && npx jest --config test/jest.config.ts --testPathPattern="levenshtein" --no-coverage</automated>
  </verify>
  <done>
    levenshteinRatio function exported, all test cases pass, 0 = identical, 100 = complete rewrite, values are integers 0-100.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install ESLint react-hooks plugin, wire edit distance into send flow, fix all hook violations</name>
  <files>
    enterprise-work-assistant/src/package.json
    enterprise-work-assistant/src/.eslintrc.json
    enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
    enterprise-work-assistant/src/AssistantDashboard/index.ts
    enterprise-work-assistant/src/AssistantDashboard/components/types.ts
    enterprise-work-assistant/src/AssistantDashboard/hooks/useCardData.ts
    enterprise-work-assistant/src/AssistantDashboard/components/App.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CommandBar.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/BriefingCard.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/ConfidenceCalibration.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/FilterBar.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CardGallery.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx
  </files>
  <action>
    **Part A: ESLint react-hooks plugin setup**

    1. Install: `cd enterprise-work-assistant/src && npm install --save-dev eslint-plugin-react-hooks@^4.6.0`
       (Use v4.x — compatible with eslint ^8.50.0 already in the project. Do NOT install v5 which requires eslint 9+.)

    2. Update `.eslintrc.json`:
       - Add `"react-hooks"` to the `"plugins"` array
       - Add `"plugin:react-hooks/recommended"` to the `"extends"` array (this sets rules-of-hooks to error and exhaustive-deps to warn)
       - Override `"react-hooks/exhaustive-deps": "error"` in `"rules"` to promote it from warn to error per user decision
       - Add `"settings": { "react": { "version": "detect" } }` (react-hooks plugin needs this)

    **Part B: Wire edit distance into the send flow**

    3. Update `onSendDraft` callback signature throughout the chain:
       - In `types.ts` AppProps interface: change `onSendDraft: (cardId: string, finalText: string) => void` to `onSendDraft: (cardId: string, finalText: string, editDistanceRatio: number) => void`
       - In `CardDetailProps` interface in CardDetail.tsx: update `onSendDraft` similarly
       - Pass through App.tsx (the prop threading should just work via spread)

    4. In `CardDetail.tsx`:
       - Import `levenshteinRatio` from `"../utils/levenshtein"`
       - In `handleConfirmSend`: compute the ratio before calling `onSendDraft`:
         ```typescript
         const originalDraft = card.humanized_draft ?? "";
         const ratio = levenshteinRatio(originalDraft, finalText);
         onSendDraft(card.id, finalText, ratio);
         ```
       - This replaces the existing `onSendDraft(card.id, finalText)` call

    5. In `index.ts`:
       - Update `handleSendDraft` signature to `(cardId: string, finalText: string, editDistanceRatio: number) => void`
       - Update the JSON payload: `JSON.stringify({ cardId, finalText, editDistanceRatio })`
       - Update the comment to reflect the new payload shape

    **Part C: Fix all hook dependency violations**

    6. Run `npm run lint` and fix ALL react-hooks/exhaustive-deps violations:
       - For each violation, add the missing dependency to the dependency array
       - Do NOT use `// eslint-disable` comments to suppress — fix the actual dependency
       - If adding a dependency would cause infinite re-renders, use `useRef` to break the cycle or extract the value into a stable reference
       - Common patterns to watch for:
         - Callbacks that reference state/props but aren't in the dep array → add them
         - Object/array dependencies that change every render → memoize with useMemo
         - Functions passed as props → wrap with useCallback if not already done

    7. After fixing all violations, run `npm run lint` to confirm zero errors. The codebase must pass with zero warnings from react-hooks rules.
  </action>
  <verify>
    <automated>cd enterprise-work-assistant/src && npm run lint 2>&1 | grep -c "react-hooks" | xargs test 0 -eq && echo "PASS: zero react-hooks errors" || echo "FAIL: react-hooks errors remain"</automated>
  </verify>
  <done>
    - eslint-plugin-react-hooks installed as devDependency
    - .eslintrc.json has react-hooks plugin with both rules at error level
    - `npm run lint` passes with zero hook-related errors
    - CardDetail computes levenshteinRatio on send and passes to onSendDraft
    - index.ts handleSendDraft includes editDistanceRatio in JSON output
    - All existing tests still pass (run `npm test` to verify no regressions)
  </done>
</task>

</tasks>

<verification>
1. `cd enterprise-work-assistant/src && npm run lint` — exits 0 with no react-hooks errors
2. `cd enterprise-work-assistant/src && npx jest --config test/jest.config.ts --no-coverage` — all tests pass including levenshtein
3. Grep check: `grep -r "eslint-disable.*react-hooks" enterprise-work-assistant/src/AssistantDashboard/` returns no results (no suppressed violations)
4. Grep check: `grep "editDistanceRatio" enterprise-work-assistant/src/AssistantDashboard/index.ts` confirms ratio is in output payload
5. Grep check: `grep "levenshteinRatio" enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx` confirms computation happens on send
</verification>

<success_criteria>
- ESLint react-hooks plugin at error level, zero violations across codebase
- Levenshtein utility produces integer 0-100 ratio, tested with edge cases
- Send draft output includes editDistanceRatio (0 for unedited, computed value for edited)
- All existing tests pass without regression
</success_criteria>

<output>
After completion, create `.planning/phases/14-sender-intelligence-completion/14-01-SUMMARY.md`
</output>
