---
phase: 03-pcf-build-configuration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - enterprise-work-assistant/src/AssistantDashboard/ControlManifest.Input.xml
  - enterprise-work-assistant/src/AssistantDashboard/components/FilterBar.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CardGallery.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx
  - enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
  - enterprise-work-assistant/src/.eslintrc.json
  - enterprise-work-assistant/src/package.json
autonomous: true
requirements:
  - PCF-01
  - PCF-05
  - PCF-06

must_haves:
  truths:
    - "ControlManifest.Input.xml declares platform-library Fluent version 9.46.2"
    - "No source file imports from @fluentui/react-theme -- all token imports use @fluentui/react-components"
    - "@fluentui/react-components is pinned at ^9.46.0 in package.json"
    - "bun install followed by bun run build completes with zero errors and zero warnings"
    - "bun run lint completes with zero warnings"
    - "bun.lockb is committed to the repository"
  artifacts:
    - path: "enterprise-work-assistant/src/AssistantDashboard/ControlManifest.Input.xml"
      provides: "Correct platform-library version declaration"
      contains: 'version="9.46.2"'
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/FilterBar.tsx"
      provides: "Consolidated Fluent UI imports from react-components"
      contains: "tokens"
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CardGallery.tsx"
      provides: "Consolidated Fluent UI imports from react-components"
      contains: "tokens"
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx"
      provides: "Consolidated Fluent UI imports into single import block"
      contains: "tokens"
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx"
      provides: "Consolidated Fluent UI imports into single import block"
      contains: "tokens"
    - path: "enterprise-work-assistant/src/.eslintrc.json"
      provides: "ESLint config allowing console.warn for zero-warning build"
      contains: "no-console"
    - path: "enterprise-work-assistant/src/bun.lockb"
      provides: "Deterministic Bun lockfile for reproducible installs"
  key_links:
    - from: "enterprise-work-assistant/src/AssistantDashboard/ControlManifest.Input.xml"
      to: "platform-library Fluent v9.46.2"
      via: "platform-library element version attribute"
      pattern: 'platform-library name="Fluent" version="9.46.2"'
    - from: "enterprise-work-assistant/src/AssistantDashboard/components/FilterBar.tsx"
      to: "@fluentui/react-components"
      via: "import statement for tokens"
      pattern: 'import.*tokens.*from.*@fluentui/react-components'
    - from: "enterprise-work-assistant/src/AssistantDashboard/components/CardGallery.tsx"
      to: "@fluentui/react-components"
      via: "import statement for tokens"
      pattern: 'import.*tokens.*from.*@fluentui/react-components'
---

<objective>
Fix PCF build configuration: update the manifest platform-library version, consolidate all Fluent UI imports to use @fluentui/react-components (eliminating @fluentui/react-theme), switch to Bun as package manager, and achieve a clean build with zero errors and zero warnings.

Purpose: The PCF control currently cannot build correctly due to an incorrect platform-library version (9.0 instead of 9.46.2) and has incorrect import paths for Fluent UI tokens. These must be fixed before any code-level fixes in later phases.
Output: A clean-building PCF project with correct manifest, consolidated imports, Bun lockfile, and zero-warning lint.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pcf-build-configuration/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix manifest version and consolidate all Fluent UI imports</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/ControlManifest.Input.xml
    enterprise-work-assistant/src/AssistantDashboard/components/FilterBar.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CardGallery.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CardItem.tsx
    enterprise-work-assistant/src/AssistantDashboard/components/CardDetail.tsx
  </files>
  <action>
**1. Fix ControlManifest.Input.xml (PCF-01):**
Change the Fluent platform-library version from `9.0` to `9.46.2`. The line:
```xml
<platform-library name="Fluent" version="9.0" />
```
becomes:
```xml
<platform-library name="Fluent" version="9.46.2" />
```
The allowed range is `>=9.4.0 <=9.46.2` per Microsoft docs. `9.46.2` is the current ceiling.

**2. Fix FilterBar.tsx imports (PCF-05):**
Replace the two separate import lines:
```typescript
import { Badge, Text } from "@fluentui/react-components";
import { tokens } from "@fluentui/react-theme";
```
with a single consolidated import:
```typescript
import { Badge, Text, tokens } from "@fluentui/react-components";
```
`@fluentui/react-components` re-exports `tokens` from `@fluentui/react-theme` internally -- the token names are identical, no API mapping needed.

**3. Fix CardGallery.tsx imports (PCF-05):**
Replace the two separate import lines:
```typescript
import { Text } from "@fluentui/react-components";
import { tokens } from "@fluentui/react-theme";
```
with a single consolidated import:
```typescript
import { Text, tokens } from "@fluentui/react-components";
```

**4. Consolidate CardItem.tsx imports (cleanup per CONTEXT.md):**
Merge the two `@fluentui/react-components` import lines:
```typescript
import {
    Card,
    Badge,
    Text,
} from "@fluentui/react-components";
import { tokens } from "@fluentui/react-components";
```
into a single import:
```typescript
import {
    Card,
    Badge,
    Text,
    tokens,
} from "@fluentui/react-components";
```

**5. Consolidate CardDetail.tsx imports (cleanup per CONTEXT.md):**
Merge the two `@fluentui/react-components` import lines:
```typescript
import {
    Button,
    Badge,
    Text,
    Link,
    Textarea,
    Spinner,
    MessageBar,
    MessageBarBody,
} from "@fluentui/react-components";
import { tokens } from "@fluentui/react-components";
```
into a single import:
```typescript
import {
    Button,
    Badge,
    Text,
    Link,
    Textarea,
    Spinner,
    MessageBar,
    MessageBarBody,
    tokens,
} from "@fluentui/react-components";
```

**6. Verify no remaining @fluentui/react-theme references:**
Run `grep -r "@fluentui/react-theme" enterprise-work-assistant/src/` -- must return zero results.
  </action>
  <verify>
- `grep -r "@fluentui/react-theme" enterprise-work-assistant/src/` returns no results
- `grep 'version="9.46.2"' enterprise-work-assistant/src/AssistantDashboard/ControlManifest.Input.xml` confirms manifest version
- Each of FilterBar.tsx, CardGallery.tsx, CardItem.tsx, CardDetail.tsx has exactly one `@fluentui/react-components` import line that includes `tokens`
  </verify>
  <done>
- ControlManifest.Input.xml declares `platform-library name="Fluent" version="9.46.2"`
- Zero files import from `@fluentui/react-theme`
- All four files with `tokens` usage have consolidated single-import-block from `@fluentui/react-components`
  </done>
</task>

<task type="auto">
  <name>Task 2: Switch to Bun, fix ESLint config, and verify clean build</name>
  <files>
    enterprise-work-assistant/src/.eslintrc.json
    enterprise-work-assistant/src/package.json
    enterprise-work-assistant/src/bun.lockb
  </files>
  <action>
**1. Fix ESLint no-console rule for zero-warning build:**
In `.eslintrc.json`, change the `no-console` rule from:
```json
"no-console": "warn"
```
to:
```json
"no-console": ["warn", { "allow": ["warn"] }]
```
This allows `console.warn` (used in `useCardData.ts` line 63 for legitimate error logging) while still warning on `console.log`, `console.error`, etc. This satisfies the zero-warnings requirement.

**2. Verify package.json already correct (PCF-06):**
Confirm `@fluentui/react-components` is `"^9.46.0"` -- no change needed (already correct per research). Confirm `@fluentui/react-theme` is NOT listed in dependencies or devDependencies -- no change needed (already absent per research).

**3. Audit dependencies:**
Review all dependencies in `package.json`. Per research, all packages are actively used:
- `@fluentui/react-components: ^9.46.0` -- keep (platform components)
- `@fluentui/react-icons: ^2.0.245` -- keep (icons in CardItem/CardDetail)
- `@types/react: ~16.14.0` -- keep (matches platform React version)
- `@typescript-eslint/eslint-plugin: ^6.0.0` -- keep (lint rules)
- `@typescript-eslint/parser: ^6.0.0` -- keep (ESLint parser)
- `eslint: ^8.50.0` -- keep (linter)
- `pcf-scripts: ^1` -- keep (build toolchain)
- `pcf-start: ^1` -- keep (test harness)
- `typescript: ^4.9.5` -- keep (compiler)

No packages to remove. No unused dependencies found.

**4. Switch to Bun and generate lockfile:**
Run from `enterprise-work-assistant/src/`:
```bash
bun install
```
This generates `bun.lockb`. If `package-lock.json` exists, delete it (Bun replaces npm). Per research, no `package-lock.json` currently exists.

**5. Verify clean build (zero errors, zero warnings):**
```bash
bun run build
```
Must complete with zero errors AND zero warnings. If `bun run build` fails due to Bun/pcf-scripts incompatibility (LOW risk per research), fall back to running the build step via `npx pcf-scripts build` while keeping Bun for package management.

**6. Verify clean lint (zero warnings):**
```bash
bun run lint
```
Must complete with zero warnings. The ESLint `no-console` fix from step 1 should resolve the only known warning source (`console.warn` in `useCardData.ts`).

**7. Run security audit:**
```bash
bun audit
```
Report results. Fix auto-fixable issues. Flag anything requiring manual attention with a TODO comment in the SUMMARY.

**8. Commit bun.lockb:**
Ensure `bun.lockb` is tracked by git (`.gitignore` does not exclude it -- confirmed by research). Stage and commit it.
  </action>
  <verify>
- `bun run build` exits with code 0 and output contains no "error" or "warning" lines
- `bun run lint` exits with code 0 and output shows zero warnings
- `ls enterprise-work-assistant/src/bun.lockb` confirms lockfile exists
- `git ls-files enterprise-work-assistant/src/bun.lockb` confirms lockfile is tracked (after commit)
- `grep '"@fluentui/react-components": "\\^9.46.0"' enterprise-work-assistant/src/package.json` confirms version pin unchanged
- `bun audit` output reviewed and documented
  </verify>
  <done>
- `bun install && bun run build` completes with zero errors and zero warnings
- `bun run lint` completes with zero warnings
- `bun.lockb` exists and is committed to git
- `@fluentui/react-components` remains at `^9.46.0` in package.json
- Dependency audit shows no unused packages and security audit results documented
  </done>
</task>

</tasks>

<verification>
1. `grep -r "@fluentui/react-theme" enterprise-work-assistant/src/` returns zero results
2. `grep 'version="9.46.2"' enterprise-work-assistant/src/AssistantDashboard/ControlManifest.Input.xml` matches
3. `bun run build` in `enterprise-work-assistant/src/` exits 0 with clean output
4. `bun run lint` in `enterprise-work-assistant/src/` exits 0 with zero warnings
5. `bun.lockb` exists and is git-tracked
6. `package.json` has `@fluentui/react-components: ^9.46.0` and no `@fluentui/react-theme`
</verification>

<success_criteria>
- PCF-01: ControlManifest.Input.xml declares platform-library Fluent version 9.46.2
- PCF-05: All token imports use @fluentui/react-components, zero references to @fluentui/react-theme in any source file
- PCF-06: @fluentui/react-components pinned at ^9.46.0 in package.json (already correct, verified)
- Build: `bun install && bun run build` completes with zero errors, zero warnings
- Lint: `bun run lint` completes with zero warnings
- Lockfile: bun.lockb committed for deterministic installs
</success_criteria>

<output>
After completion, create `.planning/phases/03-pcf-build-configuration/03-01-SUMMARY.md`
</output>
