---
phase: 09-tech-debt-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - enterprise-work-assistant/schemas/output-schema.json
  - enterprise-work-assistant/docs/agent-flows.md
  - enterprise-work-assistant/docs/deployment-guide.md
  - .planning/REQUIREMENTS.md
  - .planning/PROJECT.md
  - .planning/v1.0-MILESTONE-AUDIT.md
autonomous: true
requirements: []

must_haves:
  truths:
    - "output-schema.json priority enum uses null (not N/A) matching types.ts Priority | null contract"
    - "output-schema.json temporal_horizon enum uses null (not N/A) matching types.ts TemporalHorizon | null contract"
    - "agent-flows.md relative path to output-schema.json resolves to an existing file"
    - "deployment-guide.md Tested with annotation says Bun 1.3.8 (not 1.2.x)"
    - "DOC-03 requirement text says Execute Agent and wait across all planning docs"
  artifacts:
    - path: "enterprise-work-assistant/schemas/output-schema.json"
      provides: "Nullable enum convention aligned with types.ts"
      contains: '"enum": \\["High", "Medium", "Low", null\\]'
    - path: "enterprise-work-assistant/docs/agent-flows.md"
      provides: "Correct relative path to output-schema.json"
      contains: "../schemas/output-schema.json"
    - path: "enterprise-work-assistant/docs/deployment-guide.md"
      provides: "Accurate Bun version annotation"
      contains: "Tested with Bun 1.3.8"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Corrected DOC-03 requirement text"
      contains: "Execute Agent and wait"
    - path: ".planning/PROJECT.md"
      provides: "Corrected action location text"
      contains: "Execute Agent and wait"
  key_links:
    - from: "enterprise-work-assistant/schemas/output-schema.json"
      to: "enterprise-work-assistant/src/AssistantDashboard/components/types.ts"
      via: "Nullable enum convention alignment"
      pattern: 'type.*\\["string", "null"\\].*enum.*null'
---

<objective>
Fix four non-blocking inconsistencies identified during the v1.0 milestone audit: schema enum convention divergence (N/A vs null), broken documentation relative path, inaccurate Bun version annotation, and stale DOC-03 requirement text.

Purpose: Close all tech debt items from v1.0-MILESTONE-AUDIT.md so the project reaches full production-ready consistency.
Output: Five corrected files + audit log update noting downstream divergence discovered during schema fix.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-tech-debt-cleanup/09-RESEARCH.md
@.planning/v1.0-MILESTONE-AUDIT.md
@enterprise-work-assistant/schemas/output-schema.json
@enterprise-work-assistant/src/AssistantDashboard/components/types.ts
@enterprise-work-assistant/docs/agent-flows.md
@enterprise-work-assistant/docs/deployment-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix schema enum convention and broken doc path</name>
  <files>
    enterprise-work-assistant/schemas/output-schema.json
    enterprise-work-assistant/docs/agent-flows.md
  </files>
  <action>
    **Fix 1 — Schema enum convention (output-schema.json):**

    In `enterprise-work-assistant/schemas/output-schema.json`, update the `priority` field (around lines 37-39):
    - Change `"type": "string"` to `"type": ["string", "null"]`
    - Change `"enum": ["High", "Medium", "Low", "N/A"]` to `"enum": ["High", "Medium", "Low", null]`
    - Change description from `"N/A for SKIP or items where priority is not applicable."` to `"Null for SKIP or items where priority is not applicable."`

    Update the `temporal_horizon` field (around lines 41-44):
    - Change `"type": "string"` to `"type": ["string", "null"]`
    - Change `"enum": ["TODAY", "THIS_WEEK", "NEXT_WEEK", "BEYOND", "N/A"]` to `"enum": ["TODAY", "THIS_WEEK", "NEXT_WEEK", "BEYOND", null]`
    - Change description from `"N/A for non-calendar triggers or SKIP."` to `"Null for non-calendar triggers or SKIP."`

    This matches the JSON Schema draft-07 nullable enum pattern already used by other fields in the same file (research_log, key_findings, confidence_score) and aligns with the types.ts contract: `Priority | null` and `TemporalHorizon | null`.

    IMPORTANT: Do NOT touch any other files that still use "N/A" (agent prompt, Dataverse table, PA expressions). Per user decision, strictly fix only these 4 audit items. The ingestion boundary in useCardData.ts already bridges the convention gap.

    **Fix 2 — Broken relative path (agent-flows.md):**

    In `enterprise-work-assistant/docs/agent-flows.md` (around line 58), change:
    - `../../schemas/output-schema.json` to `../schemas/output-schema.json`

    The current path goes up two levels (to repo root) where no schemas/ directory exists. One `../` from docs/ reaches enterprise-work-assistant/ which contains schemas/.

    **Verification:**
    - Run `node -e "console.log(JSON.parse(require('fs').readFileSync('enterprise-work-assistant/schemas/output-schema.json','utf8')).properties.priority)"` to validate JSON syntax and confirm priority field structure.
    - Run `node -e "const p=require('path');const f='enterprise-work-assistant/docs';console.log(require('fs').existsSync(p.resolve(f,'../schemas/output-schema.json')))"` to verify the relative path resolves to an existing file.
    - Confirm alignment with types.ts by reading the Priority and TemporalHorizon types.
  </action>
  <verify>
    1. `node -e "JSON.parse(require('fs').readFileSync('enterprise-work-assistant/schemas/output-schema.json','utf8'));console.log('JSON valid')"` prints "JSON valid"
    2. `node -e "const s=JSON.parse(require('fs').readFileSync('enterprise-work-assistant/schemas/output-schema.json','utf8'));const p=s.properties.priority;console.log(p.type,p.enum)"` shows `[ 'string', 'null' ] [ 'High', 'Medium', 'Low', null ]`
    3. `node -e "const p=require('path');const f='enterprise-work-assistant/docs';console.log(require('fs').existsSync(p.resolve(f,'../schemas/output-schema.json')))"` prints `true`
  </verify>
  <done>
    output-schema.json priority and temporal_horizon enums use null convention (not "N/A"), matching types.ts Priority | null and TemporalHorizon | null contract. agent-flows.md relative path to output-schema.json resolves correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix version annotation, stale requirement text, and log discovered divergence</name>
  <files>
    enterprise-work-assistant/docs/deployment-guide.md
    .planning/REQUIREMENTS.md
    .planning/PROJECT.md
    .planning/v1.0-MILESTONE-AUDIT.md
  </files>
  <action>
    **Fix 3 — Bun version annotation (deployment-guide.md):**

    In `enterprise-work-assistant/docs/deployment-guide.md` (around line 9), change:
    - `Tested with Bun 1.2.x` to `Tested with Bun 1.3.8`

    Phase 3 tested with Bun 1.3.8 (confirmed in STATE.md decision log). The minimum version `>= 1.x` is correct and stays.

    **Fix 4 — DOC-03 stale requirement text (REQUIREMENTS.md + PROJECT.md):**

    In `.planning/REQUIREMENTS.md` (around line 33), change:
    - `Agent-flows.md documents how to locate and configure the Copilot Studio connector "Run a prompt" action`
    - to: `Agent-flows.md documents how to locate and configure the Microsoft Copilot Studio connector "Execute Agent and wait" action`

    In `.planning/PROJECT.md` (around line 22), change:
    - `"Run a prompt" action location` to `"Execute Agent and wait" action location`

    Per user decision: apply this fix across ALL planning docs where "Run a prompt" appears as a current instruction. Do NOT edit historical records (Phase 7 plans/summaries/verification, STATE.md decision log, ROADMAP.md success criteria). The research identified exactly these two files as having stale instructional text.

    **Audit log update (v1.0-MILESTONE-AUDIT.md):**

    After the schema fix, note the newly visible downstream divergence: the agent prompt (main-agent-system-prompt.md) still instructs the LLM to output "N/A" strings, and the Dataverse table/PA expressions still map "N/A". This is bridged by the useCardData.ts ingestion boundary at runtime but represents a convention gap. Add a note to the tech debt section of v1.0-MILESTONE-AUDIT.md documenting this as a known, non-blocking divergence for future consideration.
  </action>
  <verify>
    1. `grep "Tested with Bun 1.3.8" enterprise-work-assistant/docs/deployment-guide.md` returns a match
    2. `grep "Execute Agent and wait" .planning/REQUIREMENTS.md` returns a match on the DOC-03 line
    3. `grep "Execute Agent and wait" .planning/PROJECT.md` returns a match
    4. `grep -c "Run a prompt" .planning/REQUIREMENTS.md` returns 0 (no stale references remain in requirement descriptions)
  </verify>
  <done>
    deployment-guide.md shows "Tested with Bun 1.3.8". DOC-03 requirement text in REQUIREMENTS.md and PROJECT.md says "Execute Agent and wait" (not "Run a prompt"). Downstream divergence from schema fix logged in v1.0-MILESTONE-AUDIT.md.
  </done>
</task>

</tasks>

<verification>
1. output-schema.json is valid JSON and both priority and temporal_horizon use `"type": ["string", "null"]` with null in enum array
2. agent-flows.md path `../schemas/output-schema.json` resolves to existing file from docs/ directory
3. deployment-guide.md says "Tested with Bun 1.3.8"
4. REQUIREMENTS.md DOC-03 line says "Execute Agent and wait"
5. PROJECT.md says "Execute Agent and wait" (not "Run a prompt")
6. v1.0-MILESTONE-AUDIT.md has a note about prompt/schema convention divergence
7. No files outside the explicit fix list were modified (no scope creep)
</verification>

<success_criteria>
All four v1.0 milestone audit tech debt items are resolved:
- Schema convention divergence: FIXED (null replaces N/A in output-schema.json enums)
- Broken relative path: FIXED (../schemas/output-schema.json resolves)
- Bun version annotation: FIXED (1.3.8 replaces 1.2.x)
- Stale DOC-03 text: FIXED ("Execute Agent and wait" replaces "Run a prompt")
- Downstream divergence logged for future tracking
</success_criteria>

<output>
After completion, create `.planning/phases/09-tech-debt-cleanup/09-01-SUMMARY.md`
</output>
