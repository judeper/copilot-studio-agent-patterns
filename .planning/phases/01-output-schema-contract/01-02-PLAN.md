---
phase: 01-output-schema-contract
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - enterprise-work-assistant/prompts/main-agent-system-prompt.md
  - enterprise-work-assistant/prompts/humanizer-agent-prompt.md
autonomous: true
requirements:
  - SCHM-01
  - SCHM-03
  - SCHM-04
  - SCHM-05
  - SCHM-06

must_haves:
  truths:
    - "SKIP example (Example 4) has a descriptive string for item_summary, not null"
    - "All four prompt examples use bare integers for confidence_score (not quoted strings)"
    - "Prompt triage instructions for SKIP say agent generates a brief summary (not null)"
    - "Output schema template in prompt reflects item_summary as always-present string"
    - "draft_payload description in prompt uses null convention (no 'N/A')"
    - "Humanizer prompt input contract includes draft_type field"
    - "All four prompt examples are complete, valid JSON objects"
  artifacts:
    - path: "enterprise-work-assistant/prompts/main-agent-system-prompt.md"
      provides: "Agent system prompt with four aligned JSON examples"
      contains: "Marketing newsletter from Contoso Weekly"
    - path: "enterprise-work-assistant/prompts/humanizer-agent-prompt.md"
      provides: "Humanizer agent prompt with draft_type in input contract"
      contains: "draft_type"
  key_links:
    - from: "enterprise-work-assistant/prompts/main-agent-system-prompt.md"
      to: "enterprise-work-assistant/schemas/output-schema.json"
      via: "JSON examples and output schema template match the canonical schema"
      pattern: "item_summary.*summary"
    - from: "enterprise-work-assistant/prompts/humanizer-agent-prompt.md"
      to: "enterprise-work-assistant/schemas/output-schema.json"
      via: "Input contract matches the draft_payload handoff object in schema"
      pattern: "draft_type.*EMAIL.*TEAMS_MESSAGE"
---

<objective>
Align the main agent system prompt and humanizer agent prompt with the updated output schema contract from Plan 01. Fix SKIP-tier instructions, update JSON examples, and ensure all null convention language matches.

Purpose: The prompts are what the LLM agent actually reads to produce output. If the prompts contradict the schema, the agent will produce invalid JSON that fails downstream. The four few-shot examples are the most important alignment target because LLMs follow examples more reliably than prose instructions.

Output: Updated main-agent-system-prompt.md with corrected SKIP instructions, updated output schema template, and four consistent JSON examples. Verified humanizer-agent-prompt.md (expected: no changes needed).
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-output-schema-contract/01-CONTEXT.md
@.planning/phases/01-output-schema-contract/01-RESEARCH.md
@.planning/phases/01-output-schema-contract/01-01-SUMMARY.md
@enterprise-work-assistant/schemas/output-schema.json
@enterprise-work-assistant/prompts/main-agent-system-prompt.md
@enterprise-work-assistant/prompts/humanizer-agent-prompt.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix SKIP-tier instructions and output schema template in main agent prompt</name>
  <files>enterprise-work-assistant/prompts/main-agent-system-prompt.md</files>
  <action>
  Open main-agent-system-prompt.md and make these changes to the prose sections (NOT the examples yet -- Task 2 handles examples):

  1. **STEP 1 SKIP instructions (lines 69-72):** Change:
     ```
     If tier = SKIP, return a minimal JSON object with triage_tier = "SKIP",
     card_status = "NO_OUTPUT", item_summary = null, priority = "N/A",
     temporal_horizon = "N/A", and null for all research/draft fields.
     See the SKIP example below.
     ```
     to:
     ```
     If tier = SKIP, return a JSON object with triage_tier = "SKIP",
     card_status = "NO_OUTPUT", item_summary = a brief description of what was
     skipped and why (e.g., "Marketing newsletter — no action needed."),
     priority = "N/A", temporal_horizon = "N/A", and null for all research/draft fields.
     See the SKIP example below.
     ```
     Key change: item_summary is now a required string for SKIP, not null. Priority and temporal_horizon "N/A" are enum values (correct, keep as-is).

  2. **STEP 5 SKIP instructions (lines 143-145):** Change:
     ```
     For tier = SKIP:
     - Return a minimal JSON object with triage_tier = "SKIP", card_status = "NO_OUTPUT",
       and null/empty values for all other fields.
     ```
     to:
     ```
     For tier = SKIP:
     - Return a JSON object with triage_tier = "SKIP", card_status = "NO_OUTPUT",
       item_summary = brief description of what was skipped and why, priority = "N/A",
       temporal_horizon = "N/A", and null for all research/draft fields.
     ```
     This makes explicit that item_summary is a string, not null, for SKIP.

  3. **Output schema template - item_summary (line 192):** Change:
     ```
     "item_summary": "<1-2 sentence plain-text summary of the item. Null for SKIP.>",
     ```
     to:
     ```
     "item_summary": "<1-2 sentence plain-text summary of the item. For SKIP: brief description of what was skipped and why.>",
     ```

  4. **Output schema template - draft_payload (lines 208-210):** Change:
     ```
     "draft_payload": "<Humanizer handoff object (EMAIL/TEAMS FULL, confidence >= 40),
         or meeting briefing plain text (CALENDAR_SCAN FULL),
         or null for SKIP, LIGHT, or LOW_CONFIDENCE>",
     ```
     to:
     ```
     "draft_payload": "<Humanizer handoff object (EMAIL/TEAMS_MESSAGE FULL, confidence >= 40),
         or meeting briefing plain text (CALENDAR_SCAN FULL),
         or null for SKIP, LIGHT, and LOW_CONFIDENCE>",
     ```
     Fixes "EMAIL/TEAMS" to "EMAIL/TEAMS_MESSAGE" (matching enum) and uses "null" consistently (no "N/A" in template either -- the original template already said "null" here, but ensuring the enum name is exact).

  Do NOT touch the few-shot examples section yet (Task 2 handles that).
  Do NOT change STEP 2, STEP 3, or STEP 4 sections.
  Do NOT change the humanizer handoff object structure in STEP 5.
  </action>
  <verify>
  Read main-agent-system-prompt.md and search for these patterns:
  - No occurrence of `item_summary = null` or `item_summary null` anywhere in the file
  - No occurrence of `"N/A" for LIGHT` in draft_payload descriptions (only in priority/temporal_horizon enum contexts)
  - The SKIP instructions in STEP 1 mention generating a brief summary
  - The output schema template shows item_summary as always a string
  </verify>
  <done>
  SKIP-tier instructions in STEP 1 and STEP 5 correctly state item_summary is a brief description string (not null). Output schema template reflects non-nullable item_summary and null convention for draft_payload. No "N/A" used as a null convention anywhere.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix SKIP example and verify all four few-shot examples</name>
  <files>enterprise-work-assistant/prompts/main-agent-system-prompt.md</files>
  <action>
  Open main-agent-system-prompt.md and fix the few-shot examples section:

  1. **Example 4 SKIP (lines 291-306):** Replace the entire Example 4 JSON object.

     Current (WRONG):
     ```json
     {
       "trigger_type": "EMAIL",
       "triage_tier": "SKIP",
       "item_summary": null,
       "priority": "N/A",
       ...
     }
     ```

     Replace with:
     ```json
     {
       "trigger_type": "EMAIL",
       "triage_tier": "SKIP",
       "item_summary": "Marketing newsletter from Contoso Weekly — no action needed.",
       "priority": "N/A",
       "temporal_horizon": "N/A",
       "research_log": null,
       "key_findings": null,
       "verified_sources": null,
       "confidence_score": null,
       "card_status": "NO_OUTPUT",
       "draft_payload": null,
       "low_confidence_note": null
     }
     ```

     The key change is `item_summary` going from `null` to a descriptive string. Per user decision, use the brief descriptive format: "[description of sender/content] — [reason for SKIP classification]."

  2. **Verify Example 1 (EMAIL FULL, lines 222-249):**
     - item_summary: string (non-null) -- CORRECT
     - confidence_score: `95` (bare integer, not "95") -- CORRECT
     - draft_payload: object with draft_type field -- CORRECT
     - key_findings: string with actual findings -- CORRECT
     - No changes needed. Confirm and move on.

  3. **Verify Example 2 (TEAMS_MESSAGE LIGHT, lines 252-266):**
     - item_summary: string (non-null) -- CORRECT
     - confidence_score: null -- CORRECT (LIGHT tier)
     - key_findings: null -- CORRECT (LIGHT tier)
     - draft_payload: null -- CORRECT (LIGHT tier)
     - No changes needed. Confirm and move on.

  4. **Verify Example 3 (CALENDAR_SCAN FULL, lines 268-289):**
     - item_summary: string (non-null) -- CORRECT
     - confidence_score: `92` (bare integer) -- CORRECT
     - draft_payload: string (meeting briefing) -- CORRECT
     - key_findings: string with findings -- CORRECT
     - No changes needed. Confirm and move on.

  5. **Verify humanizer-agent-prompt.md (read only, expect no changes):**
     - Read the file and confirm:
       - Input contract (line 15-23) includes draft_type field -- CORRECT (SCHM-05)
       - confidence_score shown as `<integer 0-100>` -- CORRECT (SCHM-03)
       - No nullability issues -- the humanizer only receives the handoff object when draft_type is EMAIL or TEAMS_MESSAGE
     - If all correct, make NO changes to this file.

  Do NOT change Examples 1, 2, or 3 unless a validation issue is found (none expected based on research).
  Do NOT add a fifth example or remove any examples.
  Do NOT change the humanizer prompt unless an actual discrepancy is found.
  </action>
  <verify>
  Read main-agent-system-prompt.md examples section and confirm:
  - Example 1: item_summary is a string, confidence_score is 95 (bare integer), draft_payload has draft_type
  - Example 2: item_summary is a string, confidence_score is null, draft_payload is null
  - Example 3: item_summary is a string, confidence_score is 92 (bare integer), draft_payload is a string
  - Example 4: item_summary is "Marketing newsletter from Contoso Weekly — no action needed." (NOT null)
  - All four examples have all 12 fields (trigger_type through low_confidence_note)
  - No example has `"item_summary": null`

  Read humanizer-agent-prompt.md and confirm:
  - draft_type present in input contract
  - No changes were needed
  </verify>
  <done>
  All four few-shot examples are complete, valid JSON objects consistent with the updated output-schema.json. Example 4 (SKIP) has a descriptive string for item_summary instead of null. Humanizer prompt confirmed correct with no changes needed.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, do a full cross-file consistency check:

1. **item_summary never null in any prompt text or example:**
   - Search main-agent-system-prompt.md for `"item_summary": null` -- should return zero matches
   - Search for `item_summary = null` or `item_summary null` in prose -- should return zero matches

2. **Four complete examples present:**
   - Example 1: EMAIL FULL (humanizer handoff)
   - Example 2: TEAMS_MESSAGE LIGHT (summary only)
   - Example 3: CALENDAR_SCAN FULL (meeting briefing)
   - Example 4: EMAIL SKIP (brief summary, no research)

3. **Null convention consistent:**
   - No "N/A" used as a null convention in any description text
   - "N/A" only appears as an enum value for priority and temporal_horizon

4. **Humanizer prompt unchanged and correct:**
   - draft_type field present in input contract
   - confidence_score shown as integer
</verification>

<success_criteria>
- main-agent-system-prompt.md SKIP instructions and examples produce output that would validate against the updated output-schema.json
- All four examples are complete JSON objects with all 12 required fields
- No "item_summary": null anywhere in the file
- Humanizer prompt input contract matches the draft_payload handoff object in the schema
- No "N/A" used as a null convention (only as enum values)
</success_criteria>

<output>
After completion, create `.planning/phases/01-output-schema-contract/01-02-SUMMARY.md`
</output>
