---
phase: 01-output-schema-contract
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - enterprise-work-assistant/schemas/output-schema.json
  - enterprise-work-assistant/src/AssistantDashboard/components/types.ts
  - enterprise-work-assistant/schemas/dataverse-table.json
autonomous: true
requirements:
  - SCHM-01
  - SCHM-02
  - SCHM-03
  - SCHM-04
  - SCHM-05
  - SCHM-06

must_haves:
  truths:
    - "output-schema.json defines item_summary as required string (never null)"
    - "output-schema.json defines confidence_score as integer|null (not string)"
    - "output-schema.json draft_payload description uses 'Null' convention (no 'N/A' outside enum values)"
    - "output-schema.json key_findings description documents 'None retrieved' convention for FULL tier"
    - "output-schema.json draft_type exists inside the humanizer handoff object within draft_payload oneOf"
    - "types.ts item_summary is typed as string (not string | null)"
    - "dataverse-table.json notes.skip_items says SKIP items ARE written to Dataverse"
    - "dataverse-table.json cr_triagetier Choice column has SKIP/LIGHT/FULL options"
  artifacts:
    - path: "enterprise-work-assistant/schemas/output-schema.json"
      provides: "Canonical output schema contract"
      contains: "\"type\": \"string\""
    - path: "enterprise-work-assistant/src/AssistantDashboard/components/types.ts"
      provides: "TypeScript interfaces matching output schema"
      contains: "item_summary: string;"
    - path: "enterprise-work-assistant/schemas/dataverse-table.json"
      provides: "Dataverse table definition aligned with schema"
      contains: "SKIP-tier items ARE written"
  key_links:
    - from: "enterprise-work-assistant/src/AssistantDashboard/components/types.ts"
      to: "enterprise-work-assistant/schemas/output-schema.json"
      via: "AssistantCard interface mirrors schema properties"
      pattern: "item_summary: string;"
    - from: "enterprise-work-assistant/schemas/dataverse-table.json"
      to: "enterprise-work-assistant/schemas/output-schema.json"
      via: "Dataverse column types match schema field types"
      pattern: "cr_itemsummary.*required.*true"
---

<objective>
Fix field types, nullability, and value conventions in the schema source-of-truth files: output-schema.json, types.ts, and dataverse-table.json.

Purpose: These three files define the data contract that all downstream consumers (prompts, Power Automate flows, PCF control) depend on. Getting them correct and consistent is the foundation for all other Phase 1 work.

Output: Three updated files with item_summary made non-nullable, draft_payload "N/A" references replaced with null convention, and dataverse-table.json notes updated to reflect SKIP items being written.
</objective>

<execution_context>
@/Users/admin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/admin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-output-schema-contract/01-CONTEXT.md
@.planning/phases/01-output-schema-contract/01-RESEARCH.md
@enterprise-work-assistant/schemas/output-schema.json
@enterprise-work-assistant/src/AssistantDashboard/components/types.ts
@enterprise-work-assistant/schemas/dataverse-table.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix output-schema.json field types, descriptions, and null conventions</name>
  <files>enterprise-work-assistant/schemas/output-schema.json</files>
  <action>
  Open output-schema.json and make these exact changes:

  1. **item_summary type (line 32):** Change `"type": ["string", "null"]` to `"type": "string"`. Per user decision: item_summary is never null -- agent always generates a summary for all tiers including SKIP.

  2. **item_summary description (line 34):** Change `"Null for SKIP."` at the end of the description to:
     `"1-2 sentence plain-text summary of the triggering item. For SKIP items, a brief description of what was skipped and why (e.g., 'Marketing newsletter from Contoso Weekly — no action needed.')."`

  3. **draft_payload description (line 91):** Change:
     `"For EMAIL/TEAMS FULL with confidence >= 40: humanizer handoff object. For CALENDAR_SCAN FULL: plain-text meeting briefing. N/A for LIGHT. Null for SKIP or LOW_CONFIDENCE."`
     to:
     `"For EMAIL/TEAMS_MESSAGE FULL-tier items with confidence >= 40: humanizer handoff object. For CALENDAR_SCAN FULL-tier items: plain-text meeting briefing. Null for SKIP, LIGHT, and LOW_CONFIDENCE."`
     This eliminates "N/A" as a null-convention marker (per user decision: null universally for "not applicable"). Also fixes "EMAIL/TEAMS" to "EMAIL/TEAMS_MESSAGE" to match the enum values.

  4. **Verify these fields are already correct (no changes needed, but confirm during editing):**
     - confidence_score (line 79-83): type `["integer", "null"]` -- correct, leave as-is (SCHM-03)
     - key_findings (line 50-52): description mentions "'None retrieved' if nothing found. Null for SKIP and LIGHT." -- correct, leave as-is (SCHM-04)
     - verified_sources (line 54-56): description says "Null for SKIP and LIGHT." -- correct, leave as-is (SCHM-04)
     - draft_type inside oneOf object (lines 108-112): present with enum ["EMAIL", "TEAMS_MESSAGE"] -- correct, leave as-is (SCHM-05)
     - cr_triagetier: Not in this file (it's in dataverse-table.json) -- handled in Task 2 (SCHM-02)

  Do NOT change any other fields. Do NOT add new fields. Do NOT restructure the oneOf for draft_payload.
  </action>
  <verify>
  Read the modified output-schema.json and confirm:
  - item_summary type is `"string"` (not an array with null)
  - item_summary description mentions SKIP items getting a brief summary
  - draft_payload description says "Null for SKIP, LIGHT, and LOW_CONFIDENCE" (no "N/A")
  - confidence_score type is still `["integer", "null"]`
  - The JSON is valid (no trailing commas, no syntax errors)
  </verify>
  <done>
  output-schema.json defines item_summary as a required non-nullable string with SKIP-specific description, and draft_payload uses null convention exclusively (no "N/A" for non-draft cases). All other fields remain unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Align types.ts and dataverse-table.json with updated schema</name>
  <files>
    enterprise-work-assistant/src/AssistantDashboard/components/types.ts
    enterprise-work-assistant/schemas/dataverse-table.json
  </files>
  <action>
  **types.ts changes:**

  1. **item_summary (line 30):** Change `item_summary: string | null;` to `item_summary: string;`
     Remove the `| null` since item_summary is now always a string per the updated schema.

  2. **Verify these fields are already correct (no changes needed):**
     - confidence_score (line 36): `number | null` -- correct (TypeScript has no `integer`, `number` is the equivalent)
     - draft_payload (line 38): `DraftPayload | string | null` -- correct for the oneOf pattern
     - key_findings (line 34): `string | null` -- correct
     - verified_sources (line 35): `VerifiedSource[] | null` -- correct
     - DraftPayload interface (lines 16-24): includes draft_type field -- correct (SCHM-05)

  Do NOT change any other types. Do NOT add new fields.

  **dataverse-table.json changes:**

  1. **notes.skip_items (line 110):** Change:
     `"SKIP-tier items are NOT written to Dataverse. The Power Automate flow checks triage_tier before writing. This avoids the constraint that cr_itemsummary (the primary column) cannot be null."`
     to:
     `"SKIP-tier items ARE written to Dataverse with a brief summary in cr_itemsummary. SKIP items are hidden by default in the dashboard — users can toggle a filter to view them."`
     Per user decision: SKIP items ARE written to Dataverse, simplifying the Power Automate flow.

  2. **Verify these are already correct (no changes needed):**
     - cr_triagetier Choice column (lines 11-20): has SKIP/LIGHT/FULL options with integer values -- correct (SCHM-02)
     - cr_itemsummary (lines 35-41): type Text, required true -- correct (already non-nullable in Dataverse)
     - cr_confidencescore (lines 83-89): type WholeNumber -- correct (SCHM-03)

  Do NOT change column definitions. Do NOT add columns. Only update the notes.
  </action>
  <verify>
  Read types.ts and confirm:
  - item_summary is typed as `string` (no `| null`)
  - All other types unchanged

  Read dataverse-table.json and confirm:
  - notes.skip_items says "ARE written" (not "NOT written")
  - notes.skip_items mentions brief summary in cr_itemsummary
  - cr_triagetier column still has SKIP/LIGHT/FULL options
  - JSON is valid
  </verify>
  <done>
  types.ts AssistantCard interface matches updated output-schema.json (item_summary non-nullable). dataverse-table.json notes correctly state SKIP items ARE written to Dataverse. All column definitions and other types unchanged.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full contract alignment:

1. **item_summary non-nullable everywhere:**
   - output-schema.json: `"type": "string"` (not array with null)
   - types.ts: `item_summary: string` (not `string | null`)
   - dataverse-table.json: cr_itemsummary required: true (unchanged but confirmed)

2. **Null convention consistent:**
   - No "N/A" used as a nullability marker anywhere in descriptions (only in enum values for priority and temporal_horizon)
   - draft_payload description says "Null for SKIP, LIGHT, and LOW_CONFIDENCE"

3. **SKIP items written to Dataverse:**
   - dataverse-table.json notes confirm SKIP items ARE written

4. **Already-correct fields verified unchanged:**
   - confidence_score: integer|null in schema, number|null in types
   - key_findings/verified_sources: nullable in schema and types
   - draft_type: present in handoff object
   - cr_triagetier: SKIP/LIGHT/FULL choice column present
</verification>

<success_criteria>
- output-schema.json, types.ts, and dataverse-table.json are internally consistent on all field names, types, and nullability rules
- No "N/A" used as a null convention (only as enum values where semantically appropriate)
- SKIP-tier items are documented as written to Dataverse
- All files are valid JSON/TypeScript with no syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-output-schema-contract/01-01-SUMMARY.md`
</output>
