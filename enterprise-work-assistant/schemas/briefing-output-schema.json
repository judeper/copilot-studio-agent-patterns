{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DailyBriefingOutput",
  "description": "Output schema for the Daily Briefing Agent. Stored as cr_fulljson on a DAILY_BRIEFING card row.",
  "type": "object",
  "required": [
    "briefing_type",
    "briefing_date",
    "total_open_items",
    "day_shape",
    "action_items"
  ],
  "properties": {
    "briefing_type": {
      "type": "string",
      "enum": ["DAILY"],
      "description": "Always DAILY for this agent."
    },
    "briefing_date": {
      "type": "string",
      "format": "date",
      "description": "The date this briefing covers (YYYY-MM-DD)."
    },
    "total_open_items": {
      "type": "integer",
      "minimum": 0,
      "description": "Total count of PENDING cards at time of briefing generation."
    },
    "day_shape": {
      "type": "string",
      "maxLength": 500,
      "description": "2-3 sentence narrative describing the user's day and most critical items."
    },
    "action_items": {
      "type": "array",
      "maxItems": 5,
      "items": {
        "type": "object",
        "required": ["rank", "card_ids", "thread_summary", "recommended_action", "urgency_reason"],
        "properties": {
          "rank": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5,
            "description": "Priority rank (1 = highest)."
          },
          "card_ids": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 1,
            "description": "Dataverse row IDs of cards in this thread."
          },
          "thread_summary": {
            "type": "string",
            "maxLength": 100,
            "description": "1-sentence summary of the thread."
          },
          "recommended_action": {
            "type": "string",
            "maxLength": 200,
            "description": "Specific recommended action."
          },
          "urgency_reason": {
            "type": "string",
            "maxLength": 200,
            "description": "Data-backed explanation of ranking."
          },
          "related_calendar": {
            "type": ["string", "null"],
            "maxLength": 200,
            "description": "Related calendar event or null."
          }
        }
      }
    },
    "fyi_items": {
      "type": "array",
      "maxItems": 5,
      "items": {
        "type": "object",
        "required": ["card_ids", "summary", "category"],
        "properties": {
          "card_ids": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 1
          },
          "summary": {
            "type": "string",
            "maxLength": 150
          },
          "category": {
            "type": "string",
            "enum": ["MEETING_PREP", "INFO_UPDATE", "LOW_PRIORITY"]
          }
        }
      }
    },
    "stale_alerts": {
      "type": "array",
      "maxItems": 3,
      "items": {
        "type": "object",
        "required": ["card_id", "summary", "hours_pending", "recommended_action"],
        "properties": {
          "card_id": {
            "type": "string"
          },
          "summary": {
            "type": "string",
            "maxLength": 150
          },
          "hours_pending": {
            "type": "number",
            "minimum": 0
          },
          "recommended_action": {
            "type": "string",
            "enum": ["RESPOND", "DELEGATE", "DISMISS"]
          }
        }
      }
    }
  }
}
