{
  "tableName": "cr_assistantcard",
  "entitySetName": "cr_assistantcards",
  "displayName": "Assistant Cards",
  "pluralName": "Assistant Cards",
  "description": "Stores structured output from the Enterprise Work Assistant agent. Each row represents one processed incoming signal (email, Teams message, or calendar event).",
  "primaryColumn": "cr_itemsummary",
  "ownershipType": "UserOwned",
  "columns": [
    {
      "logicalName": "cr_triagetier",
      "displayName": "Triage Tier",
      "type": "Choice",
      "required": true,
      "description": "Classification tier assigned during triage. Primary routing dimension for filtering.",
      "options": [
        { "label": "SKIP", "value": 100000000 },
        { "label": "LIGHT", "value": 100000001 },
        { "label": "FULL", "value": 100000002 }
      ]
    },
    {
      "logicalName": "cr_triggertype",
      "displayName": "Trigger Type",
      "type": "Choice",
      "required": true,
      "description": "The type of incoming signal that triggered the agent.",
      "options": [
        { "label": "EMAIL", "value": 100000000 },
        { "label": "TEAMS_MESSAGE", "value": 100000001 },
        { "label": "CALENDAR_SCAN", "value": 100000002 },
        { "label": "DAILY_BRIEFING", "value": 100000003 },
        { "label": "SELF_REMINDER", "value": 100000004 },
        { "label": "COMMAND_RESULT", "value": 100000005 }
      ]
    },
    {
      "logicalName": "cr_itemsummary",
      "displayName": "Item Summary",
      "type": "Text",
      "maxLength": 300,
      "required": true,
      "description": "1-2 sentence plain-text summary of the triggering item."
    },
    {
      "logicalName": "cr_priority",
      "displayName": "Priority",
      "type": "Choice",
      "required": true,
      "description": "Priority level assigned during triage.",
      "options": [
        { "label": "High", "value": 100000000 },
        { "label": "Medium", "value": 100000001 },
        { "label": "Low", "value": 100000002 },
        { "label": "N/A", "value": 100000003 }
      ]
    },
    {
      "logicalName": "cr_cardstatus",
      "displayName": "Card Status",
      "type": "Choice",
      "required": true,
      "description": "Processing status of the card.",
      "options": [
        { "label": "READY", "value": 100000000 },
        { "label": "LOW_CONFIDENCE", "value": 100000001 },
        { "label": "SUMMARY_ONLY", "value": 100000002 },
        { "label": "NO_OUTPUT", "value": 100000003 },
        { "label": "NUDGE", "value": 100000004 }
      ]
    },
    {
      "logicalName": "cr_temporalhorizon",
      "displayName": "Temporal Horizon",
      "type": "Choice",
      "required": false,
      "description": "Temporal horizon for calendar items.",
      "options": [
        { "label": "TODAY", "value": 100000000 },
        { "label": "THIS_WEEK", "value": 100000001 },
        { "label": "NEXT_WEEK", "value": 100000002 },
        { "label": "BEYOND", "value": 100000003 },
        { "label": "N/A", "value": 100000004 }
      ]
    },
    {
      "logicalName": "cr_confidencescore",
      "displayName": "Confidence Score",
      "type": "WholeNumber",
      "minValue": 0,
      "maxValue": 100,
      "required": false,
      "description": "Confidence score 0-100 based on strength of retrieved evidence. Null for SKIP and LIGHT."
    },
    {
      "logicalName": "cr_fulljson",
      "displayName": "Full JSON Output",
      "type": "MultilineText",
      "maxLength": 1048576,
      "required": true,
      "description": "Complete JSON output from the agent. Parsed by the Canvas app and PCF control for rendering."
    },
    {
      "logicalName": "cr_humanizeddraft",
      "displayName": "Humanized Draft",
      "type": "MultilineText",
      "maxLength": 100000,
      "required": false,
      "description": "Polished draft produced by the Humanizer Agent. Populated asynchronously after initial card creation."
    },
    {
      "logicalName": "cr_cardoutcome",
      "displayName": "Card Outcome",
      "type": "Choice",
      "required": false,
      "description": "What the user did with this card. Set to PENDING by default on card creation.",
      "options": [
        { "label": "PENDING", "value": 100000000 },
        { "label": "SENT_AS_IS", "value": 100000001 },
        { "label": "SENT_EDITED", "value": 100000002 },
        { "label": "DISMISSED", "value": 100000003 },
        { "label": "EXPIRED", "value": 100000004 }
      ]
    },
    {
      "logicalName": "cr_outcometimestamp",
      "displayName": "Outcome Timestamp",
      "type": "DateTime",
      "required": false,
      "description": "When the user acted on this card."
    },
    {
      "logicalName": "cr_senttimestamp",
      "displayName": "Sent Timestamp",
      "type": "DateTime",
      "required": false,
      "description": "When the email was sent via the Send flow (audit trail)."
    },
    {
      "logicalName": "cr_sentrecipient",
      "displayName": "Sent Recipient",
      "type": "Text",
      "maxLength": 320,
      "required": false,
      "description": "Email address the draft was sent to (audit trail)."
    },
    {
      "logicalName": "cr_originalsenderemail",
      "displayName": "Original Sender Email",
      "type": "Text",
      "maxLength": 320,
      "required": false,
      "description": "Parsed email address of the original signal sender."
    },
    {
      "logicalName": "cr_originalsenderdisplay",
      "displayName": "Original Sender Display",
      "type": "Text",
      "maxLength": 200,
      "required": false,
      "description": "Display name of the original signal sender."
    },
    {
      "logicalName": "cr_originalsubject",
      "displayName": "Original Subject",
      "type": "Text",
      "maxLength": 400,
      "required": false,
      "description": "Subject line of the original signal."
    },
    {
      "logicalName": "cr_conversationclusterid",
      "displayName": "Conversation Cluster ID",
      "type": "Text",
      "maxLength": 200,
      "required": false,
      "description": "Groups related signals. EMAIL: conversationId. TEAMS: threadId. CALENDAR: seriesMasterId or normalized subject|organizer."
    },
    {
      "logicalName": "cr_sourcesignalid",
      "displayName": "Source Signal ID",
      "type": "Text",
      "maxLength": 500,
      "required": false,
      "description": "Unique ID of the original signal. EMAIL: internetMessageId. TEAMS: messageId. CALENDAR: eventId."
    },
    {
      "logicalName": "cr_reminderdue",
      "displayName": "Reminder Due",
      "type": "DateTime",
      "required": false,
      "description": "When this reminder should fire. Only populated for SELF_REMINDER trigger type cards. The Reminder Firing flow (Flow 10) queries cards where this date is in the past."
    }
  ],
  "notes": {
    "design_rationale": "Full JSON blob in cr_fulljson plus discrete columns only for server-side filtering. This avoids schema drift â€” the Canvas app uses ParseJSON() on cr_fulljson for detailed rendering while Dataverse queries filter on discrete choice columns.",
    "skip_items": "SKIP-tier items are NOT written to Dataverse. The agent flow filters them out before the Dataverse write step.",
    "non_discrete_fields": "Fields like research_log, key_findings, verified_sources, and draft_payload are only accessible via ParseJSON() on cr_fulljson. They do not have discrete columns because they are not used for server-side filtering.",
    "security": "Table uses UserOwned ownership type. Row-level security is enforced via an ownership-based security role so each user sees only their own cards.",
    "system_columns": "Standard Dataverse system columns (ownerid, createdon, modifiedon, statecode, statuscode) are created automatically and do not need to be defined here."
  }
}
